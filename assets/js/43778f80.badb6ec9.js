"use strict";(self.webpackChunkthe_open_source_with_remi=self.webpackChunkthe_open_source_with_remi||[]).push([[346,364],{6022:function(e,t,i){i.r(t),i.d(t,{Highlight:function(){return p},assets:function(){return u},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return m},toc:function(){return c}});var n=i(3117),o=(i(7294),i(3905)),a=i(4996),r=i(6395);const l={id:"firefox-ios8327",title:"Firefox for iOS - Bug fixing",sidebar_label:"10. Firefox for iOS - Bug fixing"},s=void 0,m={unversionedId:"contributions/firefox-ios8327",id:"contributions/firefox-ios8327",title:"Firefox for iOS - Bug fixing",description:"Swift",source:"@site/docs/contributions/firefox-ios#8327.md",sourceDirName:"contributions",slug:"/contributions/firefox-ios8327",permalink:"/docs/contributions/firefox-ios8327",draft:!1,editUrl:"https://github.com/ayshiff/my-open-source-journey/docs/contributions/firefox-ios#8327.md",tags:[],version:"current",frontMatter:{id:"firefox-ios8327",title:"Firefox for iOS - Bug fixing",sidebar_label:"10. Firefox for iOS - Bug fixing"},sidebar:"docs",previous:{title:"9. Caramel - Pipe operator support",permalink:"/docs/contributions/caramel91"},next:{title:"11. driftctl - Support for Terraform Cloud",permalink:"/docs/contributions/driftctl458"}},u={},p=e=>{let{children:t,color:i}=e;return(0,o.kt)("span",{style:{backgroundColor:i,borderRadius:"2px",color:"#fff",padding:"0.2rem",fontWeight:600}},t)},c=[{value:"Introduction",id:"introduction",level:2},{value:"Project",id:"project",level:3},{value:"Open Last Bookmark in 3D-touch",id:"open-last-bookmark-in-3d-touch",level:2},{value:"Context",id:"context",level:3},{value:"Current behavior",id:"current-behavior",level:3},{value:"Implement the solution",id:"implement-the-solution",level:3},{value:"Final result",id:"final-result",level:2},{value:"Misaligned texts in History Panel View",id:"misaligned-texts-in-history-panel-view",level:2},{value:"Context",id:"context-1",level:3},{value:"Current behavior",id:"current-behavior-1",level:3},{value:"Implement the solution",id:"implement-the-solution-1",level:3},{value:"Final result",id:"final-result-1",level:2},{value:"Takeaway",id:"takeaway",level:2},{value:"Problems encountered",id:"problems-encountered",level:3},{value:"What did I learn ?",id:"what-did-i-learn-",level:3}],d={Highlight:p,toc:c};function h(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,n.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("div",{className:"pr_infos"},(0,o.kt)("div",{className:"marginBottom"},(0,o.kt)("div",null,(0,o.kt)(r.Open,{date:"13 Apr 2021",mdxType:"Open"})),(0,o.kt)("span",{className:"badge badge--secondary marginRight"},"Swift"),(0,o.kt)("span",{className:"badge badge--secondary marginRight"},"Firefox"),(0,o.kt)("span",{className:"badge badge--secondary marginRight"},"iOS-app"))),(0,o.kt)("admonition",{title:"Contribution links",type:"info"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/pull/8314"},"https://github.com/mozilla-mobile/firefox-ios/pull/8314"),(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/pull/8327"},"https://github.com/mozilla-mobile/firefox-ios/pull/8327"))),(0,o.kt)("admonition",{title:"Contribution Types",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"These contributions are ",(0,o.kt)("strong",{parentName:"p"},"bug-fixes"),".")),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("div",{className:"image-wrapper"},(0,o.kt)(r.ImageWrapper,{src:(0,a.Z)("img/firefox-ios/cover.jpg"),width:"100%",alt:"Firefox iOS presentation",mdxType:"ImageWrapper"}),(0,o.kt)("em",null,"Firefox iOS presentation")),(0,o.kt)("p",null,"This contribution is composed of two PRs: ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"Open Last Bookmark in 3D-touch"))," and ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"Misaligned texts in History Panel View")),"."),(0,o.kt)("h3",{id:"project"},"Project"),(0,o.kt)("p",null,"You can find the ",(0,o.kt)("strong",{parentName:"p"},"Firefox for iOS project presentation")," ",(0,o.kt)("a",{href:"/docs/projects/firefox-ios"},(0,o.kt)(p,{color:"#203666",mdxType:"Highlight"},"here")),"."),(0,o.kt)("h2",{id:"open-last-bookmark-in-3d-touch"},"Open Last Bookmark in 3D-touch"),(0,o.kt)("h3",{id:"context"},"Context"),(0,o.kt)("p",null,"Firefox for iOS offers ",(0,o.kt)("strong",{parentName:"p"},"3D Touch")," to help the user access commonly used features. By pressing the app icon on the Home Screen, the user can open the Quick Access menu which lets him quickly perform common app-specific tasks and see interesting information. In our case it has shortcuts to open a New Private Tab, scan QR Code... and ",(0,o.kt)("strong",{parentName:"p"},"open the last bookmark"),"."),(0,o.kt)("p",null,"This shortcut displays the title and url of the last bookmarked website and open it on user tap."),(0,o.kt)("h3",{id:"current-behavior"},"Current behavior"),(0,o.kt)("p",null,'Currently when a bookmarked site is removed from the bookmark list, the "Open Last Bookmark" value from the Quick Access menu is not updated.   '),(0,o.kt)("p",null,"For example, when the user remove the last bookmark, the Quick Access menu keeps displaying it."),(0,o.kt)("admonition",{title:"Issue links ",type:"note"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/issues/8234"},"https://github.com/mozilla-mobile/firefox-ios/issues/8234"))),(0,o.kt)("h3",{id:"implement-the-solution"},"Implement the solution"),(0,o.kt)("p",null,"When we delete a bookmark, if it was the last one, we ",(0,o.kt)("strong",{parentName:"p"},"remove the shortcut")," otherwise we ",(0,o.kt)("strong",{parentName:"p"},"update the value")," of the last bookmark shortcut with the value of the most N - 1 recent one."),(0,o.kt)("div",{className:"image-wrapper"},(0,o.kt)(r.ImageWrapper,{src:(0,a.Z)("img/firefox-ios/shortcut.jpg"),width:"250px",alt:"Bookmarks shortcut",mdxType:"ImageWrapper"}),(0,o.kt)("em",null,"3D-touch Last bookmark")),(0,o.kt)("br",null),(0,o.kt)("p",null,"In our case a user can directly access the last bookmarked site with ",(0,o.kt)("inlineCode",{parentName:"p"},"profile.places.getRecentBookmarks(limit: 1)"),".",(0,o.kt)("br",{parentName:"p"}),"\n","If the bookmark items list response has a length of 0 (we have removed the last bookmarked website) then we remove the openLastBookmark shortcut with ",(0,o.kt)("inlineCode",{parentName:"p"},"removeDynamicApplicationShortcutItemOfType")," otherwise we update the last bookmark site with the most recent one (",(0,o.kt)("inlineCode",{parentName:"p"},"addDynamicApplicationShortcutItemOfType"),")."),(0,o.kt)("p",null,"Here is the code which implement the logic defined above."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="Client/Frontend/Library/HistoryPanel.swift"',title:'"Client/Frontend/Library/HistoryPanel.swift"'},"// Get most recent bookmark\nprofile.places.getRecentBookmarks(limit: 1).uponQueue(.main) { result in\n  guard let bookmarkItems = result.successValue else { return }\n  if bookmarkItems.count == 0 {\n    // Remove the openLastBookmark shortcut\n    QuickActions.sharedInstance.removeDynamicApplicationShortcutItemOfType(\n      .openLastBookmark,\n      fromApplication: .shared)\n  } else {\n    // Update the last bookmark shortcut\n    let userData = [\n      QuickActions.TabURLKey: bookmarkItems[0].url,\n      QuickActions.TabTitleKey: bookm[0].title\n    ]\n    QuickActions.sharedInstance.addDynamicApplicationShortcutItemOfType(\n      .openLastBookmark,\n      withUsuserData,\n      toApplication: .shared)\n  }\n}\n")),(0,o.kt)("h2",{id:"final-result"},"Final result"),(0,o.kt)("p",null,"Here is an example workflow demonstrating correct working of our logic."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Add ",(0,o.kt)("em",{parentName:"li"},"twitter.com")," to bookmark"),(0,o.kt)("li",{parentName:"ol"},"Add ",(0,o.kt)("em",{parentName:"li"},"facebook.com")," to bookmark"),(0,o.kt)("li",{parentName:"ol"},"Go to bookmark shortcut (showing the ",(0,o.kt)("em",{parentName:"li"},"facebook.com")," bookmark)"),(0,o.kt)("li",{parentName:"ol"},"Remove the ",(0,o.kt)("em",{parentName:"li"},"facebook.com")," bookmark"),(0,o.kt)("li",{parentName:"ol"},"Go to bookmark shortcut (showing the ",(0,o.kt)("em",{parentName:"li"},"twitter.com")," bookmark)"),(0,o.kt)("li",{parentName:"ol"},"Remove the ",(0,o.kt)("em",{parentName:"li"},"twitter.com")," bookmark "),(0,o.kt)("li",{parentName:"ol"},"Go to bookmark shortcut "),(0,o.kt)("li",{parentName:"ol"},"Notice that the bookmark shortcut has disappeared")),(0,o.kt)("div",{align:"center"},(0,o.kt)("video",{width:"180px",muted:!0,controls:!0},(0,o.kt)("source",{src:(0,a.Z)("img/firefox-ios/shortcut.mp4"),type:"video/mp4"}))),(0,o.kt)("h2",{id:"misaligned-texts-in-history-panel-view"},"Misaligned texts in History Panel View"),(0,o.kt)("h3",{id:"context-1"},"Context"),(0,o.kt)("p",null,"Firefox for iOS has an ",(0,o.kt)("strong",{parentName:"p"},"History")," tab where you can find easily access to content you've already viewed."),(0,o.kt)("h3",{id:"current-behavior-1"},"Current behavior"),(0,o.kt)("p",null,"Currently the ",(0,o.kt)("em",{parentName:"p"},"Clear Recent History")," and ",(0,o.kt)("em",{parentName:"p"},"Recently closed")," cells have misaligned texts.",(0,o.kt)("br",{parentName:"p"}),"\n","The goal of the contribution is to make the UI more consistent by aligning the labels in the cells."),(0,o.kt)("admonition",{title:"Issue links",type:"note"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/issues/8305"},"https://github.com/mozilla-mobile/firefox-ios/issues/8305"),"   ")),(0,o.kt)("h3",{id:"implement-the-solution-1"},"Implement the solution"),(0,o.kt)("p",null,"The problem was that the components were using ",(0,o.kt)("inlineCode",{parentName:"p"},"TwoLineImageOverlayCell")," (a cell with an image, a label and a description) instead of a ",(0,o.kt)("inlineCode",{parentName:"p"},"OneLineTableViewCell")," (a cell which only use an image and a label) which is more appropriate to use in our case as it meets our need and the label is centered by default."),(0,o.kt)("div",{className:"image-wrapper"},(0,o.kt)(r.ImageWrapper,{src:(0,a.Z)("img/firefox-ios/components.jpg"),width:"100%",alt:"TwoLineImageOverlayCell and OneLineTableViewCell",mdxType:"ImageWrapper"}),(0,o.kt)("em",null,"TwoLineImageOverlayCell and OneLineTableViewCell")),(0,o.kt)("br",null),(0,o.kt)("p",null,"Before implementing our logic, the ",(0,o.kt)("inlineCode",{parentName:"p"},"TwoLineImageOverlayCell")," was used with ",(0,o.kt)("inlineCode",{parentName:"p"},"cell.descriptionLabel.isHidden = true")," to hide the description as the cells don't have description.   "),(0,o.kt)("p",null,"NOTE: ",(0,o.kt)("inlineCode",{parentName:"p"},"isHidden")," is a Boolean value that determines whether the view is hidden or not."),(0,o.kt)("p",null,"The problem was that hidden views still participate in Auto Layout and retain their frames, leaving other related views in their places meaning that the description layout will still affect our cell UI."),(0,o.kt)("p",null,"As said above, the solution is to use ",(0,o.kt)("inlineCode",{parentName:"p"},"OneLineTableViewCell")," when we configure the ",(0,o.kt)("inlineCode",{parentName:"p"},"tableView"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="Client/Frontend/Library/HistoryPanel.swift"',title:'"Client/Frontend/Library/HistoryPanel.swift"'},"let oneLineCell = tableView.dequeueReusableCell(\n  withIdentifier: OneLineCellIdentifier,\n  for: indexPath\n) as! OneLineTableViewCell\n\nswitch row {\n  case .clearRecent:\n      return configureClearHistory(oneLineCell, for: indexPath)\n  case .showRecentlyClosedTabs:\n      return configureRecentlyClosed(oneLineCell, for: indexPath)\n}\n")),(0,o.kt)("h2",{id:"final-result-1"},"Final result"),(0,o.kt)("p",null,"Here is the final result showing the History tab with the texts correctly aligned."),(0,o.kt)("div",{className:"image-wrapper"},(0,o.kt)(r.ImageWrapper,{src:(0,a.Z)("img/firefox-ios/misaligned.jpg"),width:"500px",alt:"Misaligned",mdxType:"ImageWrapper"}),(0,o.kt)("em",null,"Misaligned texts in History Panel View")),(0,o.kt)("h2",{id:"takeaway"},"Takeaway"),(0,o.kt)("h3",{id:"problems-encountered"},"Problems encountered"),(0,o.kt)("p",null,"The code exploration was the part that took me the most time.",(0,o.kt)("br",{parentName:"p"}),"\n","In addition, I'm not accustomed to using XCode in my everyday developer life so I had to adapt to a different IDE than the one I usually use."),(0,o.kt)("h3",{id:"what-did-i-learn-"},"What did I learn ?"),(0,o.kt)("p",null,"This was my first contribution in Swift to an iOS app so it taught me a lot !",(0,o.kt)("br",{parentName:"p"}),"\n","Not being an iOS user, I also learned about 3D Touch in its use case in a real app."))}h.isMDXComponent=!0},6395:function(e,t,i){i.r(t),i.d(t,{ImageWrapper:function(){return d},Merged:function(){return c},Open:function(){return h},Status:function(){return k},assets:function(){return u},contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return l},metadata:function(){return m},toc:function(){return p}});var n=i(3117),o=i(7294),a=i(3905),r=i(2879);const l={},s=void 0,m={unversionedId:"utils",id:"utils",title:"utils",description:"",source:"@site/docs/utils.md",sourceDirName:".",slug:"/utils",permalink:"/docs/utils",draft:!1,editUrl:"https://github.com/ayshiff/my-open-source-journey/docs/utils.md",tags:[],version:"current",frontMatter:{}},u={},p=[],c=e=>{let{date:t}=e;return(0,a.kt)("div",null,(0,a.kt)("div",{className:"merged"},(0,a.kt)("span",null,(0,a.kt)("svg",{height:"16",viewBox:"0 0 16 16",version:"1.1",width:"16",fill:"white","aria-hidden":"true",className:"status_svg"},(0,a.kt)("path",{fillRule:"evenodd",d:"M5 3.254V3.25v.005a.75.75 0 110-.005v.004zm.45 1.9a2.25 2.25 0 10-1.95.218v5.256a2.25 2.25 0 101.5 0V7.123A5.735 5.735 0 009.25 9h1.378a2.251 2.251 0 100-1.5H9.25a4.25 4.25 0 01-3.8-2.346zM12.75 9a.75.75 0 100-1.5.75.75 0 000 1.5zm-8.5 4.5a.75.75 0 100-1.5.75.75 0 000 1.5z"})),"Merged")),t||null)},d=e=>{let{src:t,alt:i,width:n}=e;const[l,s]=o.useState(!1);return(0,a.kt)("div",null,(0,a.kt)("div",{className:"image-zoom",onClick:()=>s(!0)},(0,a.kt)("img",{src:t,alt:i,width:n})),l&&(0,a.kt)(r.Z,{mainSrc:t,onCloseRequest:()=>s(!1),mdxType:"Lightbox"}))},h=e=>{let{date:t}=e;return(0,a.kt)("div",null,(0,a.kt)("div",{className:"open"},(0,a.kt)("span",null,(0,a.kt)("svg",{height:"16",viewBox:"0 0 16 16",version:"1.1",width:"16",fill:"white","aria-hidden":"true",className:"status_svg"},(0,a.kt)("path",{fillRule:"evenodd",d:"M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"})),"Open")),t||null)},k=e=>{let{url:t}=e;const[i,n]=o.useState(null);return o.useEffect((()=>{let e=!0;return fetch(t).then((e=>e.json())).then((t=>{e&&n(t.merged)})),()=>{e=!1}}),[]),null===i?(0,a.kt)("div",null):!0===i?(0,a.kt)(c,{mdxType:"Merged"}):(0,a.kt)(h,{mdxType:"Open"})},f={toc:p,Merged:c,ImageWrapper:d,Open:h,Status:k};function g(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,n.Z)({},f,i,{components:t,mdxType:"MDXLayout"}))}g.isMDXComponent=!0}}]);