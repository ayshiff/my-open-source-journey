"use strict";(self.webpackChunkthe_open_source_with_remi=self.webpackChunkthe_open_source_with_remi||[]).push([[957,364],{6135:function(e,t,a){a.r(t),a.d(t,{Highlight:function(){return h},assets:function(){return p},contentTitle:function(){return l},default:function(){return k},frontMatter:function(){return m},metadata:function(){return o},toc:function(){return c}});var n=a(3117),r=(a(7294),a(3905)),s=a(4996),i=a(6395);const m={id:"lifetime28",title:"LifeTime - Activity detail",sidebar_label:"4. LifeTime - Activity detail"},l=void 0,o={unversionedId:"contributions/lifetime28",id:"contributions/lifetime28",title:"LifeTime - Activity detail",description:"coaching",source:"@site/docs/contributions/lifetime#28.md",sourceDirName:"contributions",slug:"/contributions/lifetime28",permalink:"/docs/contributions/lifetime28",draft:!1,editUrl:"https://github.com/ayshiff/my-open-source-journey/docs/contributions/lifetime#28.md",tags:[],version:"current",frontMatter:{id:"lifetime28",title:"LifeTime - Activity detail",sidebar_label:"4. LifeTime - Activity detail"},sidebar:"docs",previous:{title:"3. Backstage - Techdocs AWS Support",permalink:"/docs/contributions/backstage3794"},next:{title:"5. Backstage - Splunk On-Call Plugin",permalink:"/docs/contributions/backstage4416"}},p={},h=e=>{let{children:t,color:a}=e;return(0,r.kt)("span",{style:{backgroundColor:a,borderRadius:"2px",color:"#fff",padding:"0.2rem",fontWeight:600}},t)},c=[{value:"Introduction",id:"introduction",level:2},{value:"Project",id:"project",level:3},{value:"Context",id:"context",level:3},{value:"Current behavior",id:"current-behavior",level:3},{value:"Implement the solution",id:"implement-the-solution",level:2},{value:"1. Fetch the events",id:"1-fetch-the-events",level:3},{value:"Pull to Refresh",id:"pull-to-refresh",level:4},{value:"2. Add the events graph",id:"2-add-the-events-graph",level:3},{value:"Final result",id:"final-result",level:4},{value:"3. Add the events list",id:"3-add-the-events-list",level:3},{value:"Compute the events duration",id:"compute-the-events-duration",level:4},{value:"Display the duration bar",id:"display-the-duration-bar",level:4},{value:"Display the rest of the event information",id:"display-the-rest-of-the-event-information",level:4},{value:"A little extra note",id:"a-little-extra-note",level:4},{value:"Final result",id:"final-result-1",level:4},{value:"Full result - Future ?",id:"full-result---future-",level:3},{value:"Takeaway",id:"takeaway",level:2},{value:"Problems encountered",id:"problems-encountered",level:3},{value:"What did I learn ?",id:"what-did-i-learn-",level:3}],d={Highlight:h,toc:c};function k(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"pr_infos"},(0,r.kt)("div",{className:"marginBottom"},(0,r.kt)("div",null,(0,r.kt)(i.Merged,{date:"19 Jan 2021",mdxType:"Merged"})),(0,r.kt)("span",{className:"badge badge--secondary marginRight"},"coaching"),(0,r.kt)("span",{className:"badge badge--secondary marginRight"},"react-native"),(0,r.kt)("span",{className:"badge badge--secondary marginRight"},"Reason / ReScript"))),(0,r.kt)("admonition",{title:"Contribution links",type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/MoOx/LifeTime/pull/36"},"https://github.com/MoOx/LifeTime/pull/36"),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MoOx/LifeTime/pull/28"},"https://github.com/MoOx/LifeTime/pull/28"))),(0,r.kt)("admonition",{title:"Contribution Type",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"This contribution is a new ",(0,r.kt)("strong",{parentName:"p"},"feature"),".")),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"This contribution combines two things that I love: ",(0,r.kt)("strong",{parentName:"p"},"Meta Languages")," and ",(0,r.kt)("strong",{parentName:"p"},"time management"),".",(0,r.kt)("br",{parentName:"p"}),"\n","It is for me the opportunity to present you to a language that I particularly like... ",(0,r.kt)("a",{href:"https://reasonml.github.io/"},(0,r.kt)(h,{color:"#DD4B39",mdxType:"Highlight"},"Reason"))," / ",(0,r.kt)("a",{href:"https://rescript-lang.org/"},(0,r.kt)(h,{color:"#DD4B39",mdxType:"Highlight"},"ReScript")),"."),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)("br",null),(0,r.kt)("img",{alt:"LifeTime presentation",width:"100%",src:(0,s.Z)("img/lifetime/cover_final.jpg")}),(0,r.kt)("br",null),(0,r.kt)("em",null,"LifeTime = ReasonML + calendars")),(0,r.kt)("h3",{id:"project"},"Project"),(0,r.kt)("p",null,"You can find the ",(0,r.kt)("a",{href:"/docs/projects/lifetime"},(0,r.kt)(h,{color:"#203666",mdxType:"Highlight"},"LifeTime project presentation here")),"."),(0,r.kt)("h3",{id:"context"},"Context"),(0,r.kt)("p",null,"To understand a little bit more about the solution you need to understand what ",(0,r.kt)("strong",{parentName:"p"},"ReasonML")," is."),(0,r.kt)("p",null,"ReasonML is a programming language created at Facebook and powered by ",(0,r.kt)("strong",{parentName:"p"},"OCaml"),".",(0,r.kt)("br",{parentName:"p"}),"\n","It is a ",(0,r.kt)("strong",{parentName:"p"},"new syntax")," for the programming language OCaml. Anything possible in OCaml is possible in Reason!"),(0,r.kt)("p",null,"It means that we can benefit from the OCaml solid type-system.",(0,r.kt)("br",{parentName:"p"}),"\n","The idea behind Reason is pretty simple: if it compiles it will works! (99% of the time)"),(0,r.kt)("p",null,"Here is a schema showing how ReasonML fits in the OCaml ecosystem."),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)("br",null),(0,r.kt)(i.ImageWrapper,{alt:"ReasonML presentation",width:"800px",src:(0,s.Z)("img/lifetime/reasonml-presentation.png"),mdxType:"ImageWrapper"}),(0,r.kt)("em",null,"OCaml ecosystem with ReasonML")),(0,r.kt)("br",null),(0,r.kt)("p",null,"In this project we will use some Reason bindings ",(0,r.kt)("inlineCode",{parentName:"p"},"reason-react-native")," to allow to use Reason with ",(0,r.kt)("a",{href:"https://reasonml.github.io/"},(0,r.kt)(h,{color:"#48A9DC",mdxType:"Highlight"},"ReasonReact"))," (which will be used to create our React components) to make our mobile app."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"The story of Messenger.com")),(0,r.kt)("p",null,"On September 8, 2017 the team at Facebook working on ReasonML published a post where they explain that 50% of Messenger.com (the web version of Facebook Messenger) codebase was converted to Reason code."),(0,r.kt)("p",null,"Here are some benefits they noticed:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Build of the entire Reason part of the codebase is ~2s (several hundred files)"),(0,r.kt)("li",{parentName:"ul"},"Bug reports has decreased (from a few one per day to ",(0,r.kt)("strong",{parentName:"li"},"10 bugs")," a year)"),(0,r.kt)("li",{parentName:"ul"},"Refactors are faster and introduce fewer bugs")),(0,r.kt)("h3",{id:"current-behavior"},"Current behavior"),(0,r.kt)("p",null,"Let's go back to our project."),(0,r.kt)("p",null,"Currently when a User launches the app, he arrives on the ",(0,r.kt)("strong",{parentName:"p"},"Home screen")," with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("strong",{parentName:"li"},"weekly chart"),": displaying the week activities average"),(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("strong",{parentName:"li"},"top activities list"),": displaying in descending order the activities with the most time")),(0,r.kt)("p",null,"When the User tap on an activity, he goes to the associated ",(0,r.kt)("strong",{parentName:"p"},"Activity detail")," screen with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the activity ",(0,r.kt)("strong",{parentName:"li"},"category")," list where he can choose the type of the activity"),(0,r.kt)("li",{parentName:"ul"},"the possibility to ",(0,r.kt)("strong",{parentName:"li"},"hide/show")," the activity")),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)("br",null),(0,r.kt)(i.ImageWrapper,{alt:"LifeTime presentation",width:"600px",src:(0,s.Z)("img/lifetime/context.png"),mdxType:"ImageWrapper"}),(0,r.kt)("br",null),(0,r.kt)("em",null,"Home + Activity detail screens")),(0,r.kt)("br",null),(0,r.kt)("p",null,"The goal of the contribution is to add to this screen:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"an ",(0,r.kt)("strong",{parentName:"li"},"event list")," containing all the events of the activity"),(0,r.kt)("li",{parentName:"ul"},"a ",(0,r.kt)("strong",{parentName:"li"},"graph")," showing the different events")),(0,r.kt)("admonition",{title:"Issue link",type:"note"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/MoOx/LifeTime/issues/23"},"https://github.com/MoOx/LifeTime/issues/23"))),(0,r.kt)("h2",{id:"implement-the-solution"},"Implement the solution"),(0,r.kt)("admonition",{title:"code blocks",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The code blocks are intentionally incomplete for the sake of readability.",(0,r.kt)("br",{parentName:"p"}),"\n","If you want to read the full code you'll find it in the PR link at the top.")),(0,r.kt)("p",null,"The idea is pretty straightforward, here are the ",(0,r.kt)("strong",{parentName:"p"},"user stories"),":"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"As a")," User ",(0,r.kt)("strong",{parentName:"p"},"I want")," to see the events of the week I was on the home page ",(0,r.kt)("strong",{parentName:"p"},"so that")," I can directly see more details about the current week."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Find a way to keep the week currently viewed on the home screen"),(0,r.kt)("li",{parentName:"ul"},"Fetch the events related to this week"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"As a")," User ",(0,r.kt)("strong",{parentName:"p"},"I want")," to be able to switch between the 5 last weeks ",(0,r.kt)("strong",{parentName:"p"},"so that")," I can see the events related to the week that I want."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Implement the graph: the events fetch will be triggered when the user will swipe between the weeks"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"As a")," User ",(0,r.kt)("strong",{parentName:"p"},"I want")," to see the events list of the current week ",(0,r.kt)("strong",{parentName:"p"},"so that")," I can see more details about the events."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Implement the events list")))),(0,r.kt)("h3",{id:"1-fetch-the-events"},"1. Fetch the events"),(0,r.kt)("p",null,"Before fetching the events, we need to know from which week we'll fetch them."),(0,r.kt)("p",null,"To do so, the ",(0,r.kt)("inlineCode",{parentName:"p"},"TopActivites")," component (which is responsible for showing the activities) will need to know the current week the user is on."),(0,r.kt)("p",null,"When the user will tap an activity from the Home screen, we will pass to the Activity Detail Screen the current week information: the week ",(0,r.kt)("strong",{parentName:"p"},"start date")," and the week ",(0,r.kt)("strong",{parentName:"p"},"end date"),".   "),(0,r.kt)("p",null,"Here is a schema to show you the logic and the file hierarchy:"),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)(i.ImageWrapper,{alt:"Week Props",width:"800px",src:(0,s.Z)("img/lifetime/week-props.png"),mdxType:"ImageWrapper"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'{5,6} title="src/components/Home.res"',"{5,6}":!0,title:'"src/components/Home.res"'},"<TopActivities\n  mapTitleDuration\n  onFiltersPress\n  onActivityPress\n  startDate\n  endDate\n/>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'{6} title="src/components/TopActivities.res"',"{6}":!0,title:'"src/components/TopActivities.res"'},"<TouchableOpacity\n  key=title\n  onPress={_ =>\n    onActivityPress(\n      title,\n      (startDate, endDate),\n    )}>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'{14} title="src/screens/HomeScreen.res"',"{14}":!0,title:'"src/screens/HomeScreen.res"'},'<Home\n  refreshing\n  onRefreshDone\n  onGetStarted={() =>\n    navigation->Navigators.RootStack.Navigation.navigate("HelpModalScreen")}\n  onFiltersPress={() =>\n    navigation->Navigators.RootStack.Navigation.navigate("FiltersModalScreen")}\n  onActivityPress={(activity, week) => {\n    let (start, end) = week\n    navigation->Navigators.StatsStack.Navigation.navigateWithParams(\n      "ActivityOptionsScreen",\n      {\n        currentActivityTitle: Some(activity),\n        currentWeek: (start->Js.Date.toString, end->Js.Date.toString),\n      },\n    )\n  }}\n/>\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'{6,9-12} title="src/components/ActivityOptions.res"',"{6,9-12}":!0,title:'"src/components/ActivityOptions.res"'},"let make = (\n  ~activityTitle,\n  ~refreshing,\n  ~onRefreshDone,\n  ~onSkipActivity,\n  ~currentWeek: (string, string),\n) => {\n// ...\n  let ((startDate, supposedEndDate), currentDates_set) = React.useState(() => {\n    let (start, end) = currentWeek\n    (start->Js.Date.fromString, end->Js.Date.fromString)\n  })\n// ...\n}\n")),(0,r.kt)("p",null,"Now that we have our initial week we can fetch our events.",(0,r.kt)("br",{parentName:"p"}),"\n","We will see the implementation of the ",(0,r.kt)("inlineCode",{parentName:"p"},"getEvents")," function later."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/components/ActivityOptions.res"',title:'"src/components/ActivityOptions.res"'},"let events =\n  getEvents(startDate, endDate, true)\n  ->Option.map(event =>\n    event->Calendars.filterEventsByTitle(activityTitle)->Calendars.sortEventsByDecreasingStartDate\n  )\n  ->Option.getWithDefault([])\n")),(0,r.kt)("p",null,"Here are the ",(0,r.kt)("strong",{parentName:"p"},"helpers"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"filterEventsByTitle"),": used to filter the events according to their ",(0,r.kt)("strong",{parentName:"li"},"title")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sortEventsByDecreasingStartDate"),": used to sort the events from the ",(0,r.kt)("strong",{parentName:"li"},"most recent to the oldest"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/Calendars.res"',title:'"src/Calendars.res"'},"let filterEventsByTitle = (\n  events: array<ReactNativeCalendarEvents.calendarEventReadable>,\n  title: string,\n) => events->Array.keep(evt => evt.title == title)\n\nlet sortEventsByDecreasingStartDate = (\n  events: array<ReactNativeCalendarEvents.calendarEventReadable>,\n) => events->SortArray.stableSortBy((a, b) =>\n    a.startDate->Js.Date.fromString->Js.Date.getTime <\n      b.startDate->Js.Date.fromString->Js.Date.getTime\n      ? 1\n      : switch a.startDate->Js.Date.fromString->Js.Date.getTime >\n          b.startDate->Js.Date.fromString->Js.Date.getTime {\n        | true => -1\n        | false => 0\n        }\n  )\n")),(0,r.kt)("p",null,"This is for the initial events fetch when the user arrives on the activity detail screen.",(0,r.kt)("br",{parentName:"p"}),"\n","We will see below how to fetch the events when the user changes week or trigger the refresh."),(0,r.kt)("h4",{id:"pull-to-refresh"},"Pull to Refresh"),(0,r.kt)("p",null,"The user can refresh the data by pulling down the current screen."),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)("br",null),(0,r.kt)(i.ImageWrapper,{alt:"Pull to Refresh",width:"180px",src:(0,s.Z)("img/lifetime/pull-refresh.png"),mdxType:"ImageWrapper"}),(0,r.kt)("em",null,"Pull to Refresh logic")),(0,r.kt)("br",null),(0,r.kt)("p",null,"In the screen component, we will add three things:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"refreshing")," state which will tell if the component is ",(0,r.kt)("strong",{parentName:"li"},"reloading")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"onRefresh")," callback which will be triggered when the user will ",(0,r.kt)("strong",{parentName:"li"},"pull down")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"sets the ",(0,r.kt)("inlineCode",{parentName:"li"},"refreshing")," state to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"onRefreshDone")," callback which will be triggered once the user ",(0,r.kt)("strong",{parentName:"li"},"has finished pulling down")," ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"sets the ",(0,r.kt)("inlineCode",{parentName:"li"},"refreshing")," state to ",(0,r.kt)("inlineCode",{parentName:"li"},"false"))))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/screens/ActivityOptionsScreen.res"',title:'"src/screens/ActivityOptionsScreen.res"'},"let (refreshing, refreshing_set) = React.useState(() => false)\nlet onRefresh = React.useCallback1(() => refreshing_set(_ => true), [refreshing_set])\nlet onRefreshDone = React.useCallback1(() => refreshing_set(_ => false), [refreshing_set])\n// ...\n<ActivityOptions\n  refreshing\n  onRefreshDone\n  activityTitle=currentActivityTitle\n  currentWeek=params.currentWeek\n  onSkipActivity={() => navigation->Navigators.RootStack.Navigation.goBack()}\n/>\n")),(0,r.kt)("p",null,"Once we have set up our parent component, all that remains is for us to react to the different values of the parent's props in the child component in a ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/components/ActivityOptions.res"',title:'"src/components/ActivityOptions.res"'},"React.useEffect3(() => {\n  if refreshing {\n    requestUpdate()\n    onRefreshDone()\n  }\n  None\n}, (refreshing, requestUpdate, onRefreshDone))\n/>\n")),(0,r.kt)("h3",{id:"2-add-the-events-graph"},"2. Add the events graph"),(0,r.kt)("p",null,"We will display the events in the form of a chronogram."),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)(i.ImageWrapper,{alt:"Chronogram",width:"480px",src:(0,s.Z)("img/lifetime/chronogram.png"),mdxType:"ImageWrapper"})),(0,r.kt)("p",null,"This chronogram will be used to display all the events ",(0,r.kt)("strong",{parentName:"p"},"day by day"),"."),(0,r.kt)("p",null,"When the user changes the current week, we will update ",(0,r.kt)("inlineCode",{parentName:"p"},"startDate")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"supposedEndDate")," seen above (1. Fetch the events).   "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"onViewableItemsChanged")," will trigger the events fetch with the new week range."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/components/ActivityOptions.res"',title:'"src/components/ActivityOptions.res"'},"let onViewableItemsChanged = React.useRef(itemsChanged =>\n  if itemsChanged.viewableItems->Array.length == 1 {\n    itemsChanged.viewableItems[0]\n    ->Option.map(wrapper => currentDates_set(_ => wrapper.item))\n    ->ignore\n  }\n).current\n// ...\n<FlatList\n  // ...\n  onViewableItemsChanged\n/>\n")),(0,r.kt)("p",null,"Every time events are fetched, the results are ",(0,r.kt)("strong",{parentName:"p"},"stored")," in a Map with (startDate, endDate).",(0,r.kt)("br",{parentName:"p"}),"\n","When we don't allow the function to fetch new events, it will look in the Map to see if the values has already been fetched and if so it will return the events.\nYou can see this like a store for our events."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Calendars - getEvents"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/Calendars.res"',title:'"src/Calendars.res"'},"let getEvents = React.useCallback2((startDate, endDate, allowFetch) => {\n  let res = eventsMapByRange->Map.String.get(makeMapKey(startDate, endDate))\n  if res->Option.isNone {\n    let res = eventsMapByRange->Map.String.get(makeMapKey(startDate, endDate))\n    if res->Option.isNone && allowFetch {\n      fetchAllEvents(\n        startDate->Js.Date.toISOString,\n        endDate->Js.Date.toISOString,\n        // we filter calendar later cause if you UNSELECT ALL\n        // this `fetchAllEvents` DEFAULT TO ALL\n        None,\n      )\n      ->FutureJs.fromPromise(error => {\n        // @todo error!\n        Js.log(error)\n        // setEventsMapByRange(eventsMapByRange => {\n        //   eventsMapByRange->Map.String.set(\n        //     makeMapKey(startDate, endDate),\n        //     None,\n        //   )\n        // });\n        error\n      })\n      ->Future.tapOk(res =>\n        setEventsMapByRange(eventsMapByRange =>\n          eventsMapByRange->Map.String.set(makeMapKey(startDate, endDate), Some(res))\n        )\n      )\n      ->ignore\n      ()\n    }\n  }\n  res->Option.flatMap(res => res)\n}, (eventsMapByRange, setEventsMapByRange))\n(getEvents, updatedAt, requestUpdate)\n}\n"))),(0,r.kt)("br",null),(0,r.kt)("p",null,"As we have already fetched our events in the parent component ",(0,r.kt)("inlineCode",{parentName:"p"},"ActivityOptions"),", we'll need to retrieve the events already fetched.\nTo do so, we will set the boolean argument ",(0,r.kt)("inlineCode",{parentName:"p"},"allowFetch")," (3rd argument of ",(0,r.kt)("inlineCode",{parentName:"p"},"getEvents"),") to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-reason",metastring:'title="src/components/WeeklyBarChartDetail.res"',title:'"src/components/WeeklyBarChartDetail.res"'},"@react.component\nlet make = (\n  ~today: Js.Date.t,\n  ~todayFirst,\n  ~previousFirst,\n  ~startDate,\n  ~supposedEndDate,\n  ~activityTitle,\n  ~style,\n) => {\n  let (settings, _setSettings) = React.useContext(AppSettings.context)\n  let (getEvents, _updatedAt, _requestUpdate) = React.useContext(Calendars.context)\n\n  let endDate = supposedEndDate->Date.min(today)\n  let events =\n    getEvents(startDate, endDate, false)\n    ->Option.map(event => event->filterEventsByTitle(activityTitle))\n    ->Option.getWithDefault([])\n\n  let categoryId = settings->Calendars.categoryIdFromActivityTitle(activityTitle)\n\n  <WeeklyGraphDetail events startDate supposedEndDate categoryId />\n}\n")),(0,r.kt)("p",null,"Now we are going to process our data in order to adapt it to our graph.   "),(0,r.kt)("p",null,"We need to group events that occur on the same day together.\nTo do so, we will compute a matrix thanks to the function ",(0,r.kt)("inlineCode",{parentName:"p"},"eventsPerDate")," which will return our data in the form: ",(0,r.kt)("inlineCode",{parentName:"p"},"(date, (event1, event2...)...)")),(0,r.kt)("p",null,"This function iterates through all the days of the week and tests against the events if it overlaps with the current day.",(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("strong",{parentName:"p"},"Note:")," We also have to handle the case where an event starts on a day and ends the next day.\nThis is the reason why we do ",(0,r.kt)("inlineCode",{parentName:"p"},"Date.max(startOfDate)")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Date.min(endOfDate)")," in code sample bellow."),(0,r.kt)("p",null,"For each event we compute the starting point and the ending point of the time range."),(0,r.kt)("p",null,"There is 24 x 60 = ",(0,r.kt)("strong",{parentName:"p"},"1440min")," within a day.",(0,r.kt)("br",{parentName:"p"}),"\n","We know the available width for our graph, so we can compute a ",(0,r.kt)("em",{parentName:"p"},"unit")," which will correspond to 1 minute in our timeline."),(0,r.kt)("p",null,(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"u"),(0,r.kt)("mi",{parentName:"mrow"},"n"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mo",{parentName:"mrow"},"="),(0,r.kt)("mfrac",{parentName:"mrow"},(0,r.kt)("mrow",{parentName:"mfrac"},(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"v"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"l"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"b"),(0,r.kt)("mi",{parentName:"mrow"},"l"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"W"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"d"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"h")),(0,r.kt)("mn",{parentName:"mfrac"},"1440"))),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"unit = \\frac{availableWidth}{1440}")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.65952em",verticalAlign:"0em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"u"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,r.kt)("span",{parentName:"span",className:"mrel"},"="),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1.2251079999999999em",verticalAlign:"-0.345em"}}),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,r.kt)("span",{parentName:"span",className:"mfrac"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8801079999999999em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.6550000000000002em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},"1"),(0,r.kt)("span",{parentName:"span",className:"mord mtight"},"4"),(0,r.kt)("span",{parentName:"span",className:"mord mtight"},"4"),(0,r.kt)("span",{parentName:"span",className:"mord mtight"},"0")))),(0,r.kt)("span",{parentName:"span",style:{top:"-3.23em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,r.kt)("span",{parentName:"span",style:{top:"-3.394em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"v"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.01968em"}},"l"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"b"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.01968em"}},"l"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.13889em"}},"W"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"d"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"h"))))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.345em"}},(0,r.kt)("span",{parentName:"span"}))))),(0,r.kt)("span",{parentName:"span",className:"mclose nulldelimiter"}))))))),(0,r.kt)("p",null,"We can now put our ranges in our graph."),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)(i.ImageWrapper,{alt:"Timeline",width:"650px",src:(0,s.Z)("img/lifetime/timeline.png"),mdxType:"ImageWrapper"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/components/WeeklyGraphDetail.res"',title:'"src/components/WeeklyGraphDetail.res"'},'let slices = 6\nlet graphHeight = 160.\nlet graphLetterHeight = 16.\n\nlet (settings, _setSettings) = React.useContext(AppSettings.context)\n\nlet theme = Theme.useTheme(AppSettings.useTheme())\n\n// Get the activity color\nlet (_, _, colorName, _) = ActivityCategories.getFromId(categoryId)\nlet backgroundColor = colorName->ActivityCategories.getColor(theme.mode)\n\n// Computes the different dates of our week\nlet supposedNumberOfDays = Date.durationInMs(startDate, supposedEndDate)->Date.msToDays\nlet dates =\n  Array.range(0, supposedNumberOfDays->int_of_float)->Array.map(n =>\n    startDate->DateFns.addDays(n->Js.Int.toFloat)\n  )\n\nlet eventsPerDate = React.useMemo4(() => {\n  let events = events->Calendars.filterEvents(settings)\n  let minutesInDay = 1440.\n  let minUnit = width /. minutesInDay\n  dates->Array.map(date => {\n    let startOfDate = date->Date.startOfDay\n    let startOfDateMin = date->Date.startOfDay->Js.Date.getTime->Date.msToMin\n    let endOfDate = date->Date.endOfDay\n    (date, events->Array.map(evt => {\n        if (\n          Date.hasOverlap(\n            evt.startDate->Js.Date.fromString,\n            evt.endDate->Js.Date.fromString,\n            date,\n          )\n        ) {\n          let start =\n            (evt.startDate\n            ->Js.Date.fromString\n            ->Date.max(startOfDate)\n            ->Js.Date.getTime\n            ->Date.msToMin -. startOfDateMin) *. minUnit\n          let end =\n            (evt.endDate\n            ->Js.Date.fromString\n            ->Date.min(endOfDate)\n            ->Js.Date.getTime\n            ->Date.msToMin -. startOfDateMin) *. minUnit\n          (evt.id, start, end)\n        } else {\n          ("", 0., 0.)\n        }\n      })->Array.keep(((id, _, _)) => id != ""))\n  })\n}, (events, settings, dates, width))\n')),(0,r.kt)("h4",{id:"final-result"},"Final result"),(0,r.kt)("p",null,"The user can change weeks by swiping to the right or left."),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)("br",null),(0,r.kt)(i.ImageWrapper,{alt:"Activity chart",width:"300px",src:(0,s.Z)("img/lifetime/activity-chart.png"),mdxType:"ImageWrapper"}),(0,r.kt)("em",null,"Activity chart")),(0,r.kt)("h3",{id:"3-add-the-events-list"},"3. Add the events list"),(0,r.kt)("p",null,"We will display the following information about the event:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"event ",(0,r.kt)("strong",{parentName:"li"},"date")," in the format: DD-MM"),(0,r.kt)("li",{parentName:"ul"},"event ",(0,r.kt)("strong",{parentName:"li"},"start date")," in the format: HH:SS"),(0,r.kt)("li",{parentName:"ul"},"event ",(0,r.kt)("strong",{parentName:"li"},"end date")," in the format: HH:SS"),(0,r.kt)("li",{parentName:"ul"},"event ",(0,r.kt)("strong",{parentName:"li"},"duration")," in the form of a duration bar")),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)("br",null),(0,r.kt)(i.ImageWrapper,{alt:"Events list details",width:"600px",src:(0,s.Z)("img/lifetime/events-list-detail.png"),mdxType:"ImageWrapper"}),(0,r.kt)("em",null,"Events list")),(0,r.kt)("h4",{id:"compute-the-events-duration"},"Compute the events duration"),(0,r.kt)("p",null,"As seen above, the event duration will be displayed as a duration bar.",(0,r.kt)("br",{parentName:"p"}),"\n","To do so we will need to compute some values:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"availableWidthForBar")," which corresponds to the total width we can use to display the duration bar"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"maxDuration")," which corresponds to the max duration through all the events"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"eventsWithDuration")," which is create an Array with ",(0,r.kt)("inlineCode",{parentName:"li"},"(event, duration)"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/components/Events.res"',title:'"src/components/Events.res"'},"// Set the layout width\nlet (width, setWidth) = React.useState(() => 0.)\nlet onLayout = React.useCallback1((layoutEvent: Event.layoutEvent) => {\n  let width = layoutEvent.nativeEvent.layout.width\n  setWidth(_ => width)\n}, [setWidth])\n\nlet availableWidthForBar = width -. 85. -. SpacedView.space *. 4.\n\n// We compute the duration for all the events\n// It will be used to display the duration bar\nlet eventsWithDuration = events->Array.map(event => {\n  let durationInMin =\n    Date.durationInMs(\n      event.startDate->Js.Date.fromString,\n      event.endDate->Js.Date.fromString,\n    )->Date.msToMin\n  (event, durationInMin)\n})\n\n// We compute the max duration through all the events\n// It will be used to calculate the correct duration bar width\n// in accordance with the event which has the longest duration\nlet maxDuration =\n  eventsWithDuration->Array.reduce(0., (max, (_, duration)) => duration > max ? duration : max)\n")),(0,r.kt)("p",null,"If we have no events for the selected week, we will show a message to the user otherwise we will display the events list."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/components/Events.res"',title:'"src/components/Events.res"'},'// The onLayout will trigger the set_width and compute the width state value\n<View onLayout>\n  {switch eventsWithDuration->Array.length {\n  | 0 =>\n    <SpacedView horizontal=L>\n      <Center>\n        <Spacer />\n        <Text\n          style={Style.array([\n            Theme.text["title3"],\n            Theme.text["medium"],\n            theme.styles["textLight2"],\n          ])}>\n          {"No events"->React.string}\n        </Text>\n        <Spacer size=XXS />\n        <Text style={Style.array([Theme.text["footnote"], theme.styles["textLight2"]])}>\n          {"You should add some events to your calendar or activate more calendars."->React.string}\n        </Text>\n        <Spacer />\n      </Center>\n    </SpacedView>\n  | _x =>\n    <View onLayout>\n      <Row>\n        <Spacer size=S />\n        <BlockHeading\n          style={Style.array([theme.styles["background"], theme.styles["text"]])}\n          text={startDate->Js.Date.getDate->Belt.Float.toString ++\n          " - " ++\n          endDate->Js.Date.getDate->Belt.Float.toString ++\n          " " ++\n          endDate->Date.monthShortString}\n        />\n      </Row>\n      <Separator style={theme.styles["separatorOnBackground"]} />\n      {eventsWithDuration->Array.mapWithIndex((index, eventWithDuration) => {\n        let (event, duration) = eventWithDuration\n        let durationString = duration->Date.minToString\n        // Display the current event\n      })->React.array}\n    </View>\n  }\n}\n</View>\n')),(0,r.kt)("h4",{id:"display-the-duration-bar"},"Display the duration bar"),(0,r.kt)("p",null,"This component will be used to display the duration bar.",(0,r.kt)("br",{parentName:"p"}),"\n","Here is the formula to compute the width of the bar, in ",(0,r.kt)("inlineCode",{parentName:"p"},"dp"),":"),(0,r.kt)("p",null,(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"d"),(0,r.kt)("mi",{parentName:"mrow"},"u"),(0,r.kt)("mi",{parentName:"mrow"},"r"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("mi",{parentName:"mrow"},"n"),(0,r.kt)("mo",{parentName:"mrow"},"="),(0,r.kt)("mfrac",{parentName:"mrow"},(0,r.kt)("mrow",{parentName:"mfrac"},(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"v"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"n"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"D"),(0,r.kt)("mi",{parentName:"mrow"},"u"),(0,r.kt)("mi",{parentName:"mrow"},"r"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("mi",{parentName:"mrow"},"n")),(0,r.kt)("mrow",{parentName:"mfrac"},(0,r.kt)("mi",{parentName:"mrow"},"m"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"x"),(0,r.kt)("mi",{parentName:"mrow"},"D"),(0,r.kt)("mi",{parentName:"mrow"},"u"),(0,r.kt)("mi",{parentName:"mrow"},"r"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("mi",{parentName:"mrow"},"n"))),(0,r.kt)("mo",{parentName:"mrow"},"\u2217"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"v"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"l"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"b"),(0,r.kt)("mi",{parentName:"mrow"},"l"),(0,r.kt)("mi",{parentName:"mrow"},"e"),(0,r.kt)("mi",{parentName:"mrow"},"W"),(0,r.kt)("mi",{parentName:"mrow"},"i"),(0,r.kt)("mi",{parentName:"mrow"},"d"),(0,r.kt)("mi",{parentName:"mrow"},"t"),(0,r.kt)("mi",{parentName:"mrow"},"h"),(0,r.kt)("mi",{parentName:"mrow"},"F"),(0,r.kt)("mi",{parentName:"mrow"},"o"),(0,r.kt)("mi",{parentName:"mrow"},"r"),(0,r.kt)("mi",{parentName:"mrow"},"B"),(0,r.kt)("mi",{parentName:"mrow"},"a"),(0,r.kt)("mi",{parentName:"mrow"},"r")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"duration = \\frac{eventDuration}{maxDuration} * availableWidthForBar")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"u"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"o"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n"),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,r.kt)("span",{parentName:"span",className:"mrel"},"="),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"1.217331em",verticalAlign:"-0.345em"}}),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mopen nulldelimiter"}),(0,r.kt)("span",{parentName:"span",className:"mfrac"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.872331em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.6550000000000002em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"m"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"x"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02778em"}},"D"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"u"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02778em"}},"r"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"o"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"n")))),(0,r.kt)("span",{parentName:"span",style:{top:"-3.23em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"frac-line",style:{borderBottomWidth:"0.04em"}})),(0,r.kt)("span",{parentName:"span",style:{top:"-3.394em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"3em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.03588em"}},"v"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"n"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02778em"}},"D"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"u"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02778em"}},"r"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"o"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal mtight"},"n"))))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.345em"}},(0,r.kt)("span",{parentName:"span"}))))),(0,r.kt)("span",{parentName:"span",className:"mclose nulldelimiter"})),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,r.kt)("span",{parentName:"span",className:"mbin"},"\u2217"),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}})),(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.69444em",verticalAlign:"0em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.03588em"}},"v"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"b"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.01968em"}},"l"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"e"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.13889em"}},"W"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"i"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"d"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"t"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"h"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.13889em"}},"F"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"o"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.05017em"}},"B"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"a"),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r")))))),(0,r.kt)("p",null,"For example, given:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"max duration through all the events: ",(0,r.kt)("strong",{parentName:"li"},"90min")),(0,r.kt)("li",{parentName:"ul"},"current event duration: ",(0,r.kt)("strong",{parentName:"li"},"50min")),(0,r.kt)("li",{parentName:"ul"},"available width: ",(0,r.kt)("strong",{parentName:"li"},"200dp"))),(0,r.kt)("p",null,"The result will be equal to (50 / 90) ","*"," 200 = ",(0,r.kt)("strong",{parentName:"p"},"111dp")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/components/Events.res"',title:'"src/components/Events.res"'},'<Row style={Predefined.styles["alignCenter"]}>\n  <View\n    style={\n      open Style\n      array([\n        theme.styles["backgroundGray3"],\n        viewStyle(\n          ~width=(duration /. maxDuration *. availableWidthForBar)->dp,\n          ~height=6.->dp,\n          ~borderRadius=6.,\n          ~overflow=#hidden,\n          (),\n        ),\n      ])\n    }\n  />\n  <Spacer size=XXS />\n  <Text\n    style={\n      open Style\n      array([Theme.text["footnote"], theme.styles["textLight1"]])\n    }\n    numberOfLines=1\n    adjustsFontSizeToFit=true>\n    // Display the duration\n    // ex: 15h12m\n    {durationString->React.string}\n  </Text>\n</Row>\n')),(0,r.kt)("h4",{id:"display-the-rest-of-the-event-information"},"Display the rest of the event information"),(0,r.kt)("p",null,"We can now display the rest of the event information to the User."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/components/Events.res"',title:'"src/components/Events.res"'},'<View key=event.id>\n  <View style={Predefined.styles["rowSpaceBetween"]}>\n    <Row>\n      <Spacer size=S />\n      <View>\n        <Text\n          style={Style.array([styles["text"], theme.styles["textLight1"]])}\n          numberOfLines=1\n          adjustsFontSizeToFit=true>\n          {(event.endDate->Js.Date.fromString->Js.Date.getDate->Belt.Float.toString ++\n          " " ++\n          event.endDate->Js.Date.fromString->Date.monthShortString)->React.string}\n        </Text>\n        // The duration bar goes here\n      </View>\n    </Row>\n    <View>\n      // Display the start and end date of the event\n      <SpacedView vertical=XS horizontal=None>\n        <View style={Predefined.styles["row"]}>\n          <View style={Predefined.styles["flexGrow"]}>\n            <Text style={Style.array([styles["text"], theme.styles["textLight1"]])}>\n              {Js.Date.fromString(event.startDate)\n              ->Js.Date.toTimeString\n              ->Js.String2.slice(~from=0, ~to_=5)\n              ->React.string}\n            </Text>\n            <Text style={Style.array([styles["text"], theme.styles["text"]])}>\n              {Js.Date.fromString(event.endDate)\n              ->Js.Date.toTimeString\n              ->Js.String2.slice(~from=0, ~to_=5)\n              ->React.string}\n            </Text>\n          </View>\n          <Spacer size=S />\n        </View>\n      </SpacedView>\n    </View>\n  </View>\n  {index !== eventsWithDuration->Array.length - 1\n    ? <Separator style={theme.styles["separatorOnBackground"]} />\n    : React.null}\n</View>\n')),(0,r.kt)("h4",{id:"a-little-extra-note"},"A little extra note"),(0,r.kt)("p",null,"If you take a closer look you may notice the use of a component ",(0,r.kt)("inlineCode",{parentName:"p"},"Spacer"),".",(0,r.kt)("br",{parentName:"p"}),"\n","It is used to replace margins. You can learn more about Spacer ",(0,r.kt)("a",{href:"https://www.joshwcomeau.com/react/modern-spacer-gif/"},(0,r.kt)(h,{color:"#203666",mdxType:"Highlight"},"here")),"."),(0,r.kt)("p",null,"This is how it is implemented in ",(0,r.kt)("inlineCode",{parentName:"p"},"react-multiversal"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-reason",metastring:'title="react-multiversal - src/Spacer.re"',title:'"react-multiversal',"-":!0,'src/Spacer.re"':!0},"let size =\n  fun\n  | XXL => space *. 4.\n  | XL => space *. 3.\n  | L => space *. 2.\n  | M => space *. 1.\n  | S => space *. 3. /. 4.\n  | XS => space *. 2. /. 4.\n  | XXS => space *. 1. /. 4.\n  | Custom(value) => value;\n")),(0,r.kt)("p",null,"We can use several sizes that are the result of a ratio with a constant ",(0,r.kt)("inlineCode",{parentName:"p"},"space"),".",(0,r.kt)("br",{parentName:"p"}),"\n","This allows us to have more consistent margins in our application."),(0,r.kt)("h4",{id:"final-result-1"},"Final result"),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)("br",null),(0,r.kt)(i.ImageWrapper,{alt:"Events list final result",width:"300px",src:(0,s.Z)("img/lifetime/events-list.png"),mdxType:"ImageWrapper"}),(0,r.kt)("em",null,"Events list implemented")),(0,r.kt)("h3",{id:"full-result---future-"},"Full result - Future ?"),(0,r.kt)("p",null,"I will have to change some things to make the user experience more enjoyable."),(0,r.kt)("p",null,"As mentioned in the comments:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"load the current week then ",(0,r.kt)("strong",{parentName:"li"},"lazy load")," the other weeks"),(0,r.kt)("li",{parentName:"ul"},"in the same week, if a user has a lot of events, add a ",(0,r.kt)("strong",{parentName:"li"},"see more")," button to fetch the rest of the events")),(0,r.kt)("p",null,"All these improvements will improve the performance and fluidity of navigation in the application."),(0,r.kt)("p",null,"Here is the final version of the Activity detail screen:"),(0,r.kt)("div",{className:"image-wrapper"},(0,r.kt)("br",null),(0,r.kt)(i.ImageWrapper,{alt:"Final result",width:"180px",src:(0,s.Z)("img/lifetime/final.png"),mdxType:"ImageWrapper"}),(0,r.kt)("em",null,"Events list + chart")),(0,r.kt)("h2",{id:"takeaway"},"Takeaway"),(0,r.kt)("h3",{id:"problems-encountered"},"Problems encountered"),(0,r.kt)("p",null,"The first problem that I've encountered was about the way I built the Activity detail events list.",(0,r.kt)("br",{parentName:"p"}),"\n","I started by building it by fetching events from ",(0,r.kt)("strong",{parentName:"p"},"all the weeks at once"),".",(0,r.kt)("br",{parentName:"p"}),"\n","The events were grouped according to their week in the list."),(0,r.kt)("p",null,"As you can imagine, this could be problematic if the user has a lot of events and it could lead to ",(0,r.kt)("strong",{parentName:"p"},"performance issues"),".\nI then thought about fetching the events ",(0,r.kt)("strong",{parentName:"p"},"by week")," as on the Home screen (triggered when the user switch week)."),(0,r.kt)("h3",{id:"what-did-i-learn-"},"What did I learn ?"),(0,r.kt)("p",null,"As I said before, ReasonML is a language that I particularly love.",(0,r.kt)("br",{parentName:"p"}),"\n","This contribution was the opportunity to me to ",(0,r.kt)("strong",{parentName:"p"},"put into practice")," some concepts that I've learned in the past.\nMore specifically about building a ",(0,r.kt)("strong",{parentName:"p"},"mobile app")," in ReasonML."))}k.isMDXComponent=!0},6395:function(e,t,a){a.r(t),a.d(t,{ImageWrapper:function(){return d},Merged:function(){return c},Open:function(){return k},Status:function(){return u},assets:function(){return p},contentTitle:function(){return l},default:function(){return N},frontMatter:function(){return m},metadata:function(){return o},toc:function(){return h}});var n=a(3117),r=a(7294),s=a(3905),i=a(2879);const m={},l=void 0,o={unversionedId:"utils",id:"utils",title:"utils",description:"",source:"@site/docs/utils.md",sourceDirName:".",slug:"/utils",permalink:"/docs/utils",draft:!1,editUrl:"https://github.com/ayshiff/my-open-source-journey/docs/utils.md",tags:[],version:"current",frontMatter:{}},p={},h=[],c=e=>{let{date:t}=e;return(0,s.kt)("div",null,(0,s.kt)("div",{className:"merged"},(0,s.kt)("span",null,(0,s.kt)("svg",{height:"16",viewBox:"0 0 16 16",version:"1.1",width:"16",fill:"white","aria-hidden":"true",className:"status_svg"},(0,s.kt)("path",{fillRule:"evenodd",d:"M5 3.254V3.25v.005a.75.75 0 110-.005v.004zm.45 1.9a2.25 2.25 0 10-1.95.218v5.256a2.25 2.25 0 101.5 0V7.123A5.735 5.735 0 009.25 9h1.378a2.251 2.251 0 100-1.5H9.25a4.25 4.25 0 01-3.8-2.346zM12.75 9a.75.75 0 100-1.5.75.75 0 000 1.5zm-8.5 4.5a.75.75 0 100-1.5.75.75 0 000 1.5z"})),"Merged")),t||null)},d=e=>{let{src:t,alt:a,width:n}=e;const[m,l]=r.useState(!1);return(0,s.kt)("div",null,(0,s.kt)("div",{className:"image-zoom",onClick:()=>l(!0)},(0,s.kt)("img",{src:t,alt:a,width:n})),m&&(0,s.kt)(i.Z,{mainSrc:t,onCloseRequest:()=>l(!1),mdxType:"Lightbox"}))},k=e=>{let{date:t}=e;return(0,s.kt)("div",null,(0,s.kt)("div",{className:"open"},(0,s.kt)("span",null,(0,s.kt)("svg",{height:"16",viewBox:"0 0 16 16",version:"1.1",width:"16",fill:"white","aria-hidden":"true",className:"status_svg"},(0,s.kt)("path",{fillRule:"evenodd",d:"M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"})),"Open")),t||null)},u=e=>{let{url:t}=e;const[a,n]=r.useState(null);return r.useEffect((()=>{let e=!0;return fetch(t).then((e=>e.json())).then((t=>{e&&n(t.merged)})),()=>{e=!1}}),[]),null===a?(0,s.kt)("div",null):!0===a?(0,s.kt)(c,{mdxType:"Merged"}):(0,s.kt)(k,{mdxType:"Open"})},g={toc:h,Merged:c,ImageWrapper:d,Open:k,Status:u};function N(e){let{components:t,...a}=e;return(0,s.kt)("wrapper",(0,n.Z)({},g,a,{components:t,mdxType:"MDXLayout"}))}N.isMDXComponent=!0}}]);